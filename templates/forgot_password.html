@app.route('/forgot-password', methods=['GET', 'POST'])
def forgot_password():
    if request.method == 'POST':
        email = request.form['email']
        token = generate_token(email)
        link = url_for('reset_password', token=token, _external=True)
        msg = Message("Redefina sua senha", recipients=[email])
        msg.body = f"Clique no link para redefinir sua senha: {link}"
        mail.send(msg)
        return "E-mail enviado com sucesso!"
    return render_template('forgot_password.html')

@app.route('/reset-password/<token>', methods=['GET', 'POST'])
def reset_password(token):
    email = confirm_token(token)
    if not email:
        return "Token inv√°lido ou expirado."
    if request.method == 'POST':
        nova_senha = request.form['senha']
        hash_senha = bcrypt.hashpw(nova_senha.encode('utf-8'), bcrypt.gensalt())
        cur = conn.cursor()
        cur.execute("UPDATE usuarios SET senha = %s WHERE email = %s", (hash_senha, email))
        conn.commit()
        return "Senha atualizada com sucesso!"
    return render_template('reset_password.html')
